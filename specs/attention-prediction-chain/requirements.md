# 注意力预测链可视化需求文档

## 介绍

### 核心痛点
当前的注意力可视化工具显示了权重分布（红色深浅），但用户无法理解这些权重的**目的**：
- 用户看到红色权重，但不知道"模型在用这些权重预测什么"
- 缺少注意力机制的因果闭环：输入 → 注意力权重 → 预测输出
- 教学效果不完整，用户难以建立"注意力是预测机制"的认知

### 解决方案概述
在现有注意力权重可视化基础上，增加**下一token预测显示**，形成完整的因果链：
```
[我爱中国] → [红色权重分布] → [的(85%)]
  输入          注意力        预测结果
```

## 需求

### 需求1：下一token预测显示
**用户故事：** 作为注意力机制学习者，我希望看到基于当前注意力权重预测的下一个token，以便理解注意力权重的实际作用

#### 验收标准
1. WHEN 用户输入文本进行注意力分析 THEN 系统 SHALL 显示模型预测的下一个最可能token
2. IF 预测结果是特殊token（如 `</s>`、`<pad>` 等） THEN 系统 SHALL 原样显示该特殊token
3. WHEN 显示预测token THEN 系统 SHALL 使用蓝色背景与注意力权重（红色）形成视觉对比
4. WHEN 显示预测token THEN 系统 SHALL 将其放置在输入文本序列的末尾

### 需求2：预测概率显示
**用户故事：** 作为注意力机制学习者，我希望看到预测token的概率，以便理解模型预测的确定性程度

#### 验收标准
1. WHEN 显示预测token THEN 系统 SHALL 同时显示该token的预测概率（百分比格式）
2. WHEN 显示概率 THEN 系统 SHALL 格式化为 `token(概率%)` 形式，如 `的(85%)`

### 需求3：因果关系视觉增强
**用户故事：** 作为注意力机制学习者，我希望直观地看到注意力权重与预测结果的因果关系，以便理解注意力机制的工作原理

#### 验收标准
1. WHEN 同时显示注意力权重和预测token THEN 系统 SHALL 通过视觉设计暗示因果关系
2. WHEN 用户查看可视化结果 THEN 系统 SHALL 提供说明文字解释红色权重如何影响蓝色预测
3. WHEN 显示完整的可视化 THEN 系统 SHALL 保持 `输入token → 注意力权重 → 预测token` 的视觉流向

## 技术约束

### 模型输出要求
- 必须使用相同的模型和注意力权重来计算预测概率
- 预测基于最后一个位置的logits输出
- 使用softmax后的概率分布选择最高概率token

### 性能要求
- 预测计算不应显著增加响应时间
- 与现有注意力权重计算复用模型加载

### 兼容性要求
- 不破坏现有的注意力权重可视化功能
- 保持现有的tokenizer技术信息展示

## 验收测试场景

### 场景1：基础预测显示
- **输入**：`我爱中国`
- **期望**：显示注意力权重 + 预测token（如`的(85%)`）蓝色背景
- **验证**：预测token确实是模型基于注意力权重计算的最高概率选择

### 场景2：特殊token处理
- **输入**：完整句子（可能触发 `</s>` 预测）
- **期望**：正常显示 `</s>(概率%)` 而不是隐藏或替换
- **验证**：特殊token按原样显示

### 场景3：因果关系理解
- **输入**：任意文本
- **期望**：用户能从视觉上理解红色权重分布如何导致蓝色预测
- **验证**：通过用户测试确认理解效果

## P2功能（后续考虑）

### Top-K候选显示
- 鼠标悬停显示前10个候选token及概率
- 仅在核心功能验证有效后考虑实现

### 交互式权重调整
- 允许用户手动调整注意力权重查看对预测的影响
- 属于高级教学功能，优先级较低